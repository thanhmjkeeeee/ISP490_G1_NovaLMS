<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<header th:fragment="header-fragment" id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">

        <a th:href="@{/index.html}" class="logo d-flex align-items-center me-auto">
            <h1 class="sitename">Nova LMS</h1>
        </a>

        <nav id="navmenu" class="navmenu">
            <ul>
                <li><a th:href="@{/index.html}" th:classappend="${currentPage == 'index'} ? 'active'">Trang chủ</a></li>
                <li><a th:href="@{/about.html}" th:classappend="${currentPage == 'about'} ? 'active'">Giới thiệu</a></li>
                <li><a th:href="@{/courses.html}">Khóa học</a></li>
                <li><a th:href="@{/instructors.html}">Giảng viên</a></li>
                <li><a th:href="@{/pricing.html}">Học phí</a></li>
                <li><a th:href="@{/blog.html}">Tin tức</a></li>

                <li class="dropdown"><a href="#"><span>Chức năng</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                    <ul>
                        <li><a th:href="@{/contact.html}">Liên hệ</a></li>
                        <li><a th:href="@{/404.html}">Trợ giúp</a></li>
                    </ul>
                </li>

                <!-- =========================================== -->
                <!-- LOGIC: HIỂN THỊ KHI ĐÃ ĐĂNG NHẬP -->
                <!-- =========================================== -->
                <li class="dropdown" sec:authorize="isAuthenticated()" style="margin-left: 15px;">
                    <a href="#" class="d-flex align-items-center gap-2">
                        <!-- Avatar placeholder -->
                        <img th:src="@{/assets/img/person/person-1.jpg}"
                             style="width: 30px; height: 30px; object-fit: cover; border-radius: 50%;"
                             alt="Avatar">
                        <!-- Tên user (lấy từ Security Context) -->
                        <span sec:authentication="name" style="font-weight: 600;">User Name</span>
                        <i class="bi bi-chevron-down toggle-dropdown"></i>
                    </a>
                    <ul>
                        <li><a href="#">Hồ sơ cá nhân</a></li>
                        <li><a href="#">Khóa học của tôi</a></li>
                        <!-- Chỉ hiện nếu là Admin -->
                        <li sec:authorize="hasRole('ROLE_ADMIN')"><a th:href="@{/admin/dashboard}">Quản trị hệ thống</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <!-- Form Logout -->
                            <form th:action="@{/logout}" method="post" style="margin: 0;">
                                <button type="submit" style="background: none; border: none; padding: 10px 20px; width: 100%; text-align: left; font-family: inherit; font-size: 15px; color: #444444; cursor: pointer;">
                                    <i class="bi bi-box-arrow-right"></i> Đăng xuất
                                </button>
                            </form>
                        </li>
                    </ul>
                </li>
            </ul>
            <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

        <!-- =========================================== -->
        <!-- LOGIC: HIỂN THỊ KHI CHƯA ĐĂNG NHẬP -->
        <!-- =========================================== -->
        <!-- Chỉ hiện nút "Đăng Nhập" khi chưa auth -->
        <a sec:authorize="!isAuthenticated()" class="btn-getstarted" th:href="@{/login.html}">Đăng nhập</a>

    </div>
</header>

</body>
</html>